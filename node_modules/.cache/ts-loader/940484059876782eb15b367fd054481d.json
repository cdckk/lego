{"remainingRequest":"D:\\vue3-project\\lego\\node_modules\\babel-loader\\lib\\index.js!D:\\vue3-project\\lego\\node_modules\\ts-loader\\index.js??ref--15-2!D:\\vue3-project\\lego\\node_modules\\cache-loader\\dist\\cjs.js??ref--1-0!D:\\vue3-project\\lego\\node_modules\\vue-loader-v16\\dist\\index.js??ref--1-1!D:\\vue3-project\\lego\\src\\components\\ImageProcesser.vue?vue&type=script&setup=true&lang=ts","dependencies":[{"path":"D:\\vue3-project\\lego\\src\\components\\ImageProcesser.vue","mtime":1677726506345},{"path":"D:\\vue3-project\\lego\\babel.config.js","mtime":1679070494323},{"path":"D:\\vue3-project\\lego\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1674816758787},{"path":"D:\\vue3-project\\lego\\node_modules\\babel-loader\\lib\\index.js","mtime":1674816767357},{"path":"D:\\vue3-project\\lego\\node_modules\\ts-loader\\index.js","mtime":1674816768512},{"path":"D:\\vue3-project\\lego\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1674816758787},{"path":"D:\\vue3-project\\lego\\node_modules\\vue-loader-v16\\dist\\index.js","mtime":1674816769351}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IHsgZGVmaW5lQ29tcG9uZW50IGFzIF9kZWZpbmVDb21wb25lbnQgfSBmcm9tICd2dWUnOwppbXBvcnQgYXhpb3MgZnJvbSAnYXhpb3MnOwppbXBvcnQgeyBTY2lzc29yT3V0bGluZWQgfSBmcm9tICdAYW50LWRlc2lnbi9pY29ucy12dWUnOwppbXBvcnQgeyByZWYsIHdhdGNoLCBuZXh0VGljayB9IGZyb20gJ3Z1ZSc7CmltcG9ydCB7IFN0eWxlVXBsb2FkZXIgfSBmcm9tICcuLi9jb21wb25lbnRzL1N0eWxlVXBsb2FkZXInOwppbXBvcnQgQ3JvcHBlciBmcm9tICdjcm9wcGVyanMnOwpleHBvcnQgZGVmYXVsdCAvKiNfX1BVUkVfXyovX2RlZmluZUNvbXBvbmVudCh7CiAgX19uYW1lOiAnSW1hZ2VQcm9jZXNzZXInLAogIHByb3BzOiB7CiAgICBwcm9wczogewogICAgICB0eXBlOiBPYmplY3QKICAgIH0KICB9LAogIGVtaXRzOiBbJ2NoYW5nZScsICd1cGxvYWRlZCddLAogIHNldHVwKF9fcHJvcHMsIHsKICAgIGV4cG9zZSwKICAgIGVtaXQKICB9KSB7CiAgICBleHBvc2UoKTsKICAgIGNvbnN0IHByb3BzID0gX19wcm9wczsKICAgIGNvbnN0IHNob3dNb2RlbCA9IHJlZihmYWxzZSk7CiAgICAvLyBjb25zdCBiYWNrZ3JvdW5kVXJsID0gY29tcHV0ZWQoKCkgPT4gYHVybCgke3Byb3BzLnZhbHVlfSlgKQogICAgLy8gY29uc3QgYmFzZUltYWdlVXJsID0gCiAgICBjb25zdCBjcm9wcGVySW1nID0gcmVmKG51bGwpOwogICAgY29uc3QgaW1nVXJsID0gcmVmKCk7CiAgICBsZXQgY3JvcHBlcjsKICAgIC8vIOijgeWJqueahOWAvAogICAgbGV0IGNyb3BEYXRhID0gbnVsbDsKICAgIHdhdGNoKHNob3dNb2RlbCwgYXN5bmMgbmV3VmFsdWUgPT4gewogICAgICBpZiAobmV3VmFsdWUpIHsKICAgICAgICBhd2FpdCBuZXh0VGljaygpOwogICAgICAgIGlmIChjcm9wcGVySW1nLnZhbHVlKSB7CiAgICAgICAgICBjcm9wcGVyID0gbmV3IENyb3BwZXIoY3JvcHBlckltZy52YWx1ZSwgewogICAgICAgICAgICBhc3BlY3RSYXRpbzogMTYgLyA5LAogICAgICAgICAgICBjcm9wKGV2ZW50KSB7CiAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coZXZlbnQuZGV0YWlsLngpOwogICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKGV2ZW50LmRldGFpbC55KTsKICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhldmVudC5kZXRhaWwud2lkdGgpOwogICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKGV2ZW50LmRldGFpbC5oZWlnaHQpOwogICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKGV2ZW50LmRldGFpbC5yb3RhdGUpOwogICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKGV2ZW50LmRldGFpbC5zY2FsZVgpOwogICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKGV2ZW50LmRldGFpbC5zY2FsZVkpOwogICAgICAgICAgICAgIGNvbnN0IHsKICAgICAgICAgICAgICAgIHgsCiAgICAgICAgICAgICAgICB5LAogICAgICAgICAgICAgICAgd2lkdGgsCiAgICAgICAgICAgICAgICBoZWlnaHQKICAgICAgICAgICAgICB9ID0gZXZlbnQuZGV0YWlsOwogICAgICAgICAgICAgIC8vIOS4uuS7gOS5iOS4jeebtOaOpei1i+WAvOWRou+8jOWboOS4uuimgei/m+ihjOi9rOaNogogICAgICAgICAgICAgIGNyb3BEYXRhID0gewogICAgICAgICAgICAgICAgeDogTWF0aC5mbG9vcih4KSwKICAgICAgICAgICAgICAgIHk6IE1hdGguZmxvb3IoeSksCiAgICAgICAgICAgICAgICB3aWR0aDogTWF0aC5mbG9vcih3aWR0aCksCiAgICAgICAgICAgICAgICBoZWlnaHQ6IE1hdGguZmxvb3IoaGVpZ2h0KQogICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICBpZiAoY3JvcHBlcikgewogICAgICAgICAgY3JvcHBlci5kZXN0cm95KCk7CiAgICAgICAgfQogICAgICB9CiAgICB9KTsKICAgIGNvbnN0IGhhbmRsZU9rID0gKCkgPT4gewogICAgICBpZiAoY3JvcERhdGEpIHsKICAgICAgICBjb25zdCB7CiAgICAgICAgICB4LAogICAgICAgICAgeSwKICAgICAgICAgIHdpZHRoLAogICAgICAgICAgaGVpZ2h0CiAgICAgICAgfSA9IGNyb3BEYXRhOwogICAgICAgIC8vIGNvbnN0IGNyb3BwZXJVUkwgPSBwcm9wcy5wcm9wcz8uc3JjICsgYD94LW9zcy1wcm9jZXNzPWltYWdlL2Nyb3AseF8ke3h9LHlfJHt5fSx3aWR0aF8ke3dpZHRofSxoZWlnaHRfJHtoZWlnaHR9YAogICAgICAgIC8vIGNvbnNvbGUubG9nKCdjcm9wcGVyVVJMJywgY3JvcHBlclVSTCkKICAgICAgICBjcm9wcGVyLmdldENyb3BwZWRDYW52YXMoKS50b0Jsb2IoYmxvYiA9PiB7CiAgICAgICAgICBpZiAoYmxvYikgewogICAgICAgICAgICBjb25zdCBmb3JtRGF0YSA9IG5ldyBGb3JtRGF0YSgpOwogICAgICAgICAgICBmb3JtRGF0YS5hcHBlbmQoJ2Nyb3BwZWRJbWFnZScsIGJsb2IsICd0ZXN0LnBuZycpOwogICAgICAgICAgICBheGlvcy5wb3N0KCdodHRwOi8vbG9jYWxob3N0OjMwMDAvaW1nJywgZm9ybURhdGEsIHsKICAgICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgICAnQ29udGVudC10eXBlJzogJ211bHRpcGFydC9mb3JtLWRhdGEnCiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KS50aGVuKHJlcyA9PiB7CiAgICAgICAgICAgICAgY29uc29sZS5sb2coJ2Zvcm1EYXRhJywgZm9ybURhdGEpOwogICAgICAgICAgICAgIGVtaXQoJ2NoYW5nZScsIHJlcy5kYXRhLmRhdGEudXJsKTsKICAgICAgICAgICAgICBjb25zb2xlLmxvZyhyZXMuZGF0YS5kYXRhLnVybCk7CiAgICAgICAgICAgICAgc2hvd01vZGVsLnZhbHVlID0gZmFsc2U7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICAgIC8vIOabtOaWsOaWsOeahFVSTAogICAgICB9CiAgICB9OwogICAgLy8g55uR5ZCs5Zu+54mH5pyJ5rKh5pyJ5Lyg6L+H5p2lCiAgICAvLyB3YXRjaChwcm9wcy5wcm9wcywgKG5ld1ZhbHVlKSA9PiB7CiAgICAvLyAgIGNvbnNvbGUubG9nKCduZXd2YWx1ZScsIG5ld1ZhbHVlKTsKICAgIC8vICAgaW1nVXJsLnZhbHVlID0gbmV3VmFsdWUKICAgIC8vIH0seyBpbW1lZGlhdGU6IHRydWUgfSkKICAgIGNvbnN0IF9fcmV0dXJuZWRfXyA9IHsKICAgICAgc2hvd01vZGVsLAogICAgICBjcm9wcGVySW1nLAogICAgICBpbWdVcmwsCiAgICAgIGdldCBjcm9wcGVyKCkgewogICAgICAgIHJldHVybiBjcm9wcGVyOwogICAgICB9LAogICAgICBzZXQgY3JvcHBlcih2KSB7CiAgICAgICAgY3JvcHBlciA9IHY7CiAgICAgIH0sCiAgICAgIGdldCBjcm9wRGF0YSgpIHsKICAgICAgICByZXR1cm4gY3JvcERhdGE7CiAgICAgIH0sCiAgICAgIHNldCBjcm9wRGF0YSh2KSB7CiAgICAgICAgY3JvcERhdGEgPSB2OwogICAgICB9LAogICAgICBwcm9wcywKICAgICAgZW1pdCwKICAgICAgaGFuZGxlT2ssCiAgICAgIGdldCBTY2lzc29yT3V0bGluZWQoKSB7CiAgICAgICAgcmV0dXJuIFNjaXNzb3JPdXRsaW5lZDsKICAgICAgfSwKICAgICAgZ2V0IFN0eWxlVXBsb2FkZXIoKSB7CiAgICAgICAgcmV0dXJuIFN0eWxlVXBsb2FkZXI7CiAgICAgIH0KICAgIH07CiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoX19yZXR1cm5lZF9fLCAnX19pc1NjcmlwdFNldHVwJywgewogICAgICBlbnVtZXJhYmxlOiBmYWxzZSwKICAgICAgdmFsdWU6IHRydWUKICAgIH0pOwogICAgcmV0dXJuIF9fcmV0dXJuZWRfXzsKICB9Cn0pOw=="},{"version":3,"mappings":"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","names":["defineComponent","_defineComponent","axios","ScissorOutlined","ref","watch","nextTick","StyleUploader","Cropper","__name","props","type","Object","emits","setup","__props","expose","emit","showModel","cropperImg","imgUrl","cropper","cropData","newValue","value","aspectRatio","crop","event","x","y","width","height","detail","Math","floor","destroy","handleOk","getCroppedCanvas","toBlob","blob","formData","FormData","append","post","headers","then","res","console","log","data","url","__returned__","v","defineProperty","enumerable"],"sourceRoot":"","sources":["D:\\vue3-project\\lego\\node_modules\\cache-loader\\dist\\cjs.js??ref--1-0!D:\\vue3-project\\lego\\node_modules\\vue-loader-v16\\dist\\index.js??ref--1-1!D:\\vue3-project\\lego\\src\\components\\ImageProcesser.vue?vue&type=script&setup=true&lang=ts"],"sourcesContent":["import { defineComponent as _defineComponent } from 'vue'\nimport axios from 'axios'\r\nimport { ScissorOutlined } from '@ant-design/icons-vue';\r\nimport { ref, watch, PropType, nextTick, computed } from 'vue'\r\nimport { StyleUploader } from '../components/StyleUploader'\r\nimport Cropper from 'cropperjs'\r\n// 应该在model出现之前初始化\r\nimport { ImageComponentProps } from '../defaultProps'\r\n\r\nexport interface CropDataProps {\r\n  x: number;\r\n  y: number;\r\n  width: number;\r\n  height: number;\r\n}\r\n\r\n\nexport default /*#__PURE__*/_defineComponent({\n  __name: 'ImageProcesser',\n  props: {\r\n  props: {\r\n    type: Object as PropType<Partial<ImageComponentProps>> | undefined\r\n  }\r\n},\n  emits: ['change', 'uploaded'],\n  setup(__props, { expose, emit }) {\n  expose();\n\nconst props = __props;\n\r\nconst showModel = ref<boolean>(false)\r\n// const backgroundUrl = computed(() => `url(${props.value})`)\r\n// const baseImageUrl = \r\nconst cropperImg = ref<HTMLImageElement | null>(null)\r\nconst imgUrl = ref<string>()\r\nlet cropper: Cropper\r\n// 裁剪的值\r\nlet cropData: CropDataProps | null = null\r\n\r\n\r\nwatch(showModel, async (newValue) => {\r\n  if (newValue) {\r\n    await nextTick()\r\n    if (cropperImg.value) {\r\n      cropper = new Cropper(cropperImg.value, {\r\n        aspectRatio: 16 / 9,\r\n        crop(event) {\r\n          // console.log(event.detail.x);\r\n          // console.log(event.detail.y);\r\n          // console.log(event.detail.width);\r\n          // console.log(event.detail.height);\r\n          // console.log(event.detail.rotate);\r\n          // console.log(event.detail.scaleX);\r\n          // console.log(event.detail.scaleY);\r\n          const { x, y, width, height } = event.detail\r\n          // 为什么不直接赋值呢，因为要进行转换\r\n          cropData = {\r\n            x: Math.floor(x),\r\n            y: Math.floor(y),\r\n            width: Math.floor(width),\r\n            height: Math.floor(height)\r\n          }\r\n        }\r\n      })\r\n    }\r\n  } else {\r\n    if(cropper) {\r\n      cropper.destroy()\r\n    }\r\n  }\r\n  \r\n})\r\nconst handleOk = () => {\r\n  if (cropData) {\r\n    const { x, y, width, height } = cropData\r\n    // const cropperURL = props.props?.src + `?x-oss-process=image/crop,x_${x},y_${y},width_${width},height_${height}`\r\n    // console.log('cropperURL', cropperURL)\r\n    cropper.getCroppedCanvas().toBlob((blob) => {\r\n      if (blob) {\r\n        const formData = new FormData()\r\n        formData.append('croppedImage', blob, 'test.png')\r\n        axios.post('http://localhost:3000/img', formData, {\r\n          headers: {\r\n            'Content-type': 'multipart/form-data'\r\n          }\r\n        }).then(res => {\r\n          console.log('formData', formData);\r\n          \r\n          emit('change', res.data.data.url)\r\n          console.log(res.data.data.url);\r\n          \r\n          showModel.value = false\r\n        })\r\n      }\r\n    })\r\n    // 更新新的URL\r\n  }\r\n  \r\n}\r\n// 监听图片有没有传过来\r\n// watch(props.props, (newValue) => {\r\n//   console.log('newvalue', newValue);\r\n//   imgUrl.value = newValue\r\n// },{ immediate: true })\r\n\nconst __returned__ = { showModel, cropperImg, imgUrl, get cropper() { return cropper }, set cropper(v) { cropper = v }, get cropData() { return cropData }, set cropData(v) { cropData = v }, props, emit, handleOk, get ScissorOutlined() { return ScissorOutlined }, get StyleUploader() { return StyleUploader } }\nObject.defineProperty(__returned__, '__isScriptSetup', { enumerable: false, value: true })\nreturn __returned__\n}\n\n})"]}]}