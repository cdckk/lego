{"remainingRequest":"D:\\vue3-project\\lego\\node_modules\\vue-loader-v16\\dist\\index.js??ref--1-1!D:\\vue3-project\\lego\\src\\components\\Uploader.vue?vue&type=template&id=3c8050c4&scoped=true&ts=true","dependencies":[{"path":"D:\\vue3-project\\lego\\src\\components\\Uploader.vue","mtime":1676531553975},{"path":"D:\\vue3-project\\lego\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1674816758787},{"path":"D:\\vue3-project\\lego\\node_modules\\babel-loader\\lib\\index.js","mtime":1674816767357},{"path":"D:\\vue3-project\\lego\\node_modules\\ts-loader\\index.js","mtime":1674816768512},{"path":"D:\\vue3-project\\lego\\node_modules\\vue-loader-v16\\dist\\templateLoader.js","mtime":1674816774476},{"path":"D:\\vue3-project\\lego\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1674816758787},{"path":"D:\\vue3-project\\lego\\node_modules\\vue-loader-v16\\dist\\index.js","mtime":1674816769351}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:DQogIDxkaXYgY2xhc3M9ImZpbGUtdXBsb2FkIj4NCiAgICA8ZGl2IGNsYXNzPSJ1cGxvYWQtYXJlYSIgQGNsaWNrPSJ0cmlnZ2VyVXBsb2FkZXIiPg0KICAgICAgPHNsb3Qgdi1pZj0iaXNVcGxvYWRpbmciIG5hbWU9ImxvYWRpbmciPg0KICAgICAgICA8YnV0dG9uIGRpc2FibGVkPuato+WcqOS4iuS8oDwvYnV0dG9uPg0KICAgICAgPC9zbG90Pg0KDQogICAgICA8c2xvdCB2LWVsc2UgbmFtZT0iZGVmYXVsdCI+DQogICAgICAgIDxidXR0b24+54K55Ye75LiK5LygPC9idXR0b24+DQogICAgICA8L3Nsb3Q+DQogICAgICA8IS0tIDxzcGFuIHYtaWY9ImlzVXBsb2FkaW5nID09PSAnbG9hZGluZyciPuato+WcqOS4iuS8oDwvc3Bhbj4gLS0+DQogICAgICA8IS0tIDxzcGFuIHYtZWxzZS1pZj0iZmlsZVN0YXR1cyA9PT0gJ3N1Y2Nlc3MnIj7kuIrkvKDmiJDlip88L3NwYW4+DQogICAgICA8c3BhbiB2LWVsc2UtaWY9ImZpbGVTdGF0dXMgPT09ICdlcnJvciciPuS4iuS8oOWksei0pTwvc3Bhbj4gLS0+DQogICAgICA8IS0tIDxzcGFuIHYtZWxzZT7kuIrkvKDmlofku7Y8L3NwYW4+IC0tPg0KICAgIDwvZGl2Pg0KICAgIDxpbnB1dA0KICAgICAgdHlwZT0iZmlsZSINCiAgICAgIHJlZj0iZmlsZUlucHV0Ig0KICAgICAgOnN0eWxlPSJ7ZGlzcGxheTogJ25vbmUnfSINCiAgICAgIEBjaGFuZ2U9ImhhbmRsZUZpbGVDaGFuZ2UiDQogICAgLz4NCiAgICA8dWw+DQogICAgICA8bGkNCiAgICAgICAgOmNsYXNzPSJgdXBsb2FkZWQtZmlsZSB1cGxvYWQtJHtmaWxlLnN0YXR1c31gIg0KICAgICAgICB2LWZvcj0iZmlsZSBpbiB1cGxvYWRlZEZpbGVzIg0KICAgICAgICA6a2V5PSJmaWxlLnVpZCINCiAgICAgID4NCiAgICAgICAgPHNwYW4gY2xhc3M9ImZpbGVuYW1lIj57e2ZpbGUubmFtZX19PC9zcGFuPg0KICAgICAgICA8YnV0dG9uIGNsYXNzPSJkZWxldGUtaWNvbiIgQGNsaWNrPSJyZW1vdmVGaWxlKGZpbGUudWlkKSI+5Yig6ZmkPC9idXR0b24+DQogICAgICA8L2xpPg0KICAgIDwvdWw+DQogIDwvZGl2Pg0K"},{"version":3,"sources":["D:\\vue3-project\\lego\\src\\components\\Uploader.vue"],"names":[],"mappings":"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","file":"D:/vue3-project/lego/src/components/Uploader.vue","sourceRoot":"","sourcesContent":["<template>\r\n  <div class=\"file-upload\">\r\n    <div class=\"upload-area\" @click=\"triggerUploader\">\r\n      <slot v-if=\"isUploading\" name=\"loading\">\r\n        <button disabled>正在上传</button>\r\n      </slot>\r\n\r\n      <slot v-else name=\"default\">\r\n        <button>点击上传</button>\r\n      </slot>\r\n      <!-- <span v-if=\"isUploading === 'loading'\">正在上传</span> -->\r\n      <!-- <span v-else-if=\"fileStatus === 'success'\">上传成功</span>\r\n      <span v-else-if=\"fileStatus === 'error'\">上传失败</span> -->\r\n      <!-- <span v-else>上传文件</span> -->\r\n    </div>\r\n    <input\r\n      type=\"file\"\r\n      ref=\"fileInput\"\r\n      :style=\"{display: 'none'}\"\r\n      @change=\"handleFileChange\"\r\n    />\r\n    <ul>\r\n      <li\r\n        :class=\"`uploaded-file upload-${file.status}`\"\r\n        v-for=\"file in uploadedFiles\"\r\n        :key=\"file.uid\"\r\n      >\r\n        <span class=\"filename\">{{file.name}}</span>\r\n        <button class=\"delete-icon\" @click=\"removeFile(file.uid)\">删除</button>\r\n      </li>\r\n    </ul>\r\n  </div>\r\n</template>\r\n\r\n<script setup lang=\"ts\">\r\nimport { ref, defineProps, reactive, computed } from 'vue'\r\nimport axios from 'axios'\r\nimport { v4 as uuidv4} from 'uuid'\r\n\r\ntype uploadStatus = 'ready' | 'loading' | 'success' | 'error'\r\nexport interface UploadFile {\r\n uid: string;\r\n name: string;\r\n size: number;\r\n status: string;\r\n raw: File;\r\n resp?: any;\r\n}\r\n\r\nconst props = defineProps({\r\n  action: {\r\n    type: String,\r\n    default: 'http://localhost:3000/data'\r\n  }\r\n})\r\n\r\nconst fileInput = ref<null | HTMLInputElement>(null)\r\nconst fileStatus = ref<uploadStatus>('ready')\r\nconst uploadedFiles = ref<UploadFile[]>([])\r\nconst isUploading = computed(() => {\r\n  // 只要有一项的等于loading，整个按钮就是isloading\r\n  return uploadedFiles.value.some(file => file.status === 'loading' )\r\n})\r\nconst removeFile = (id: string) => {\r\n  uploadedFiles.value = uploadedFiles.value.filter(file => {\r\n    return file.uid !== id\r\n  })\r\n}\r\n\r\nconst triggerUploader = () => {\r\n  if (fileInput.value) {\r\n    fileInput.value.click()\r\n  }\r\n}\r\n\r\nconst handleFileChange = (e: Event) => {\r\n  const target = e.target as HTMLInputElement\r\n  const files = target.files\r\n  if (files) {\r\n    const uploadedFile = files[0]\r\n    const formData = new FormData()\r\n    const fileObj = reactive<UploadFile>({\r\n      uid: uuidv4(),\r\n      size: uploadedFile.size,\r\n      name: uploadedFile.name,\r\n      status: 'loading',\r\n      raw: uploadedFile\r\n    })\r\n    // const iseExistence = uploadedFiles.value.some((file) => file.name === fileObj.name )\r\n    // if(!iseExistence) {\r\n    uploadedFiles.value.push(fileObj)\r\n    // }\r\n    \r\n    formData.append(uploadedFile.name, uploadedFile)\r\n    fileStatus.value = 'loading'\r\n    axios.post(props.action, formData}, {\r\n      headers: {\r\n        'Content-Type': 'multipart/form-data'\r\n      }\r\n    }).then(res => {\r\n      console.log(res.data);\r\n      fileStatus.value = 'success'\r\n      fileObj.status = 'success'\r\n      fileObj.resp = res.data\r\n    }).catch(() => {\r\n      fileStatus.value = 'error'\r\n      fileObj.status = 'error'\r\n    }).finally(() => {\r\n      if (fileInput.value) {\r\n        fileInput.value.value = ''\r\n      }\r\n    })\r\n  }\r\n}\r\n\r\n</script>\r\n\r\n<style scoped lang=\"less\">\r\n.upload-loading {\r\n  color: yellow;\r\n}\r\n.upload-success {\r\n  color: green;\r\n}\r\n.upload-error {\r\n  color: red;\r\n}\r\n</style>"]}]}