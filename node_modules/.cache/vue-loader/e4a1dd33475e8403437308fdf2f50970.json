{"remainingRequest":"D:\\vue3-project\\lego\\node_modules\\vue-loader-v16\\dist\\index.js??ref--1-1!D:\\vue3-project\\lego\\src\\components\\Uploader.vue?vue&type=style&index=0&id=3c8050c4&scoped=true&lang=less","dependencies":[{"path":"D:\\vue3-project\\lego\\src\\components\\Uploader.vue","mtime":1676531553975},{"path":"D:\\vue3-project\\lego\\node_modules\\css-loader\\dist\\cjs.js","mtime":1674816762302},{"path":"D:\\vue3-project\\lego\\node_modules\\vue-loader-v16\\dist\\stylePostLoader.js","mtime":1674816774292},{"path":"D:\\vue3-project\\lego\\node_modules\\postcss-loader\\src\\index.js","mtime":1674816765546},{"path":"D:\\vue3-project\\lego\\node_modules\\less-loader\\dist\\cjs.js","mtime":1675142517940},{"path":"D:\\vue3-project\\lego\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1674816758787},{"path":"D:\\vue3-project\\lego\\node_modules\\vue-loader-v16\\dist\\index.js","mtime":1674816769351}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:DQoudXBsb2FkLWxvYWRpbmcgew0KICBjb2xvcjogeWVsbG93Ow0KfQ0KLnVwbG9hZC1zdWNjZXNzIHsNCiAgY29sb3I6IGdyZWVuOw0KfQ0KLnVwbG9hZC1lcnJvciB7DQogIGNvbG9yOiByZWQ7DQp9DQo="},{"version":3,"sources":["D:\\vue3-project\\lego\\src\\components\\Uploader.vue"],"names":[],"mappings":";AAsHA,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE;EACd,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;AACf;AACA,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE;EACd,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC;AACd;AACA,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE;EACZ,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;AACZ","file":"D:/vue3-project/lego/src/components/Uploader.vue","sourceRoot":"","sourcesContent":["<template>\r\n  <div class=\"file-upload\">\r\n    <div class=\"upload-area\" @click=\"triggerUploader\">\r\n      <slot v-if=\"isUploading\" name=\"loading\">\r\n        <button disabled>正在上传</button>\r\n      </slot>\r\n\r\n      <slot v-else name=\"default\">\r\n        <button>点击上传</button>\r\n      </slot>\r\n      <!-- <span v-if=\"isUploading === 'loading'\">正在上传</span> -->\r\n      <!-- <span v-else-if=\"fileStatus === 'success'\">上传成功</span>\r\n      <span v-else-if=\"fileStatus === 'error'\">上传失败</span> -->\r\n      <!-- <span v-else>上传文件</span> -->\r\n    </div>\r\n    <input\r\n      type=\"file\"\r\n      ref=\"fileInput\"\r\n      :style=\"{display: 'none'}\"\r\n      @change=\"handleFileChange\"\r\n    />\r\n    <ul>\r\n      <li\r\n        :class=\"`uploaded-file upload-${file.status}`\"\r\n        v-for=\"file in uploadedFiles\"\r\n        :key=\"file.uid\"\r\n      >\r\n        <span class=\"filename\">{{file.name}}</span>\r\n        <button class=\"delete-icon\" @click=\"removeFile(file.uid)\">删除</button>\r\n      </li>\r\n    </ul>\r\n  </div>\r\n</template>\r\n\r\n<script setup lang=\"ts\">\r\nimport { ref, defineProps, reactive, computed } from 'vue'\r\nimport axios from 'axios'\r\nimport { v4 as uuidv4} from 'uuid'\r\n\r\ntype uploadStatus = 'ready' | 'loading' | 'success' | 'error'\r\nexport interface UploadFile {\r\n uid: string;\r\n name: string;\r\n size: number;\r\n status: string;\r\n raw: File;\r\n resp?: any;\r\n}\r\n\r\nconst props = defineProps({\r\n  action: {\r\n    type: String,\r\n    default: 'http://localhost:3000/data'\r\n  }\r\n})\r\n\r\nconst fileInput = ref<null | HTMLInputElement>(null)\r\nconst fileStatus = ref<uploadStatus>('ready')\r\nconst uploadedFiles = ref<UploadFile[]>([])\r\nconst isUploading = computed(() => {\r\n  // 只要有一项的等于loading，整个按钮就是isloading\r\n  return uploadedFiles.value.some(file => file.status === 'loading' )\r\n})\r\nconst removeFile = (id: string) => {\r\n  uploadedFiles.value = uploadedFiles.value.filter(file => {\r\n    return file.uid !== id\r\n  })\r\n}\r\n\r\nconst triggerUploader = () => {\r\n  if (fileInput.value) {\r\n    fileInput.value.click()\r\n  }\r\n}\r\n\r\nconst handleFileChange = (e: Event) => {\r\n  const target = e.target as HTMLInputElement\r\n  const files = target.files\r\n  if (files) {\r\n    const uploadedFile = files[0]\r\n    const formData = new FormData()\r\n    const fileObj = reactive<UploadFile>({\r\n      uid: uuidv4(),\r\n      size: uploadedFile.size,\r\n      name: uploadedFile.name,\r\n      status: 'loading',\r\n      raw: uploadedFile\r\n    })\r\n    // const iseExistence = uploadedFiles.value.some((file) => file.name === fileObj.name )\r\n    // if(!iseExistence) {\r\n    uploadedFiles.value.push(fileObj)\r\n    // }\r\n    \r\n    formData.append(uploadedFile.name, uploadedFile)\r\n    fileStatus.value = 'loading'\r\n    axios.post(props.action, formData}, {\r\n      headers: {\r\n        'Content-Type': 'multipart/form-data'\r\n      }\r\n    }).then(res => {\r\n      console.log(res.data);\r\n      fileStatus.value = 'success'\r\n      fileObj.status = 'success'\r\n      fileObj.resp = res.data\r\n    }).catch(() => {\r\n      fileStatus.value = 'error'\r\n      fileObj.status = 'error'\r\n    }).finally(() => {\r\n      if (fileInput.value) {\r\n        fileInput.value.value = ''\r\n      }\r\n    })\r\n  }\r\n}\r\n\r\n</script>\r\n\r\n<style scoped lang=\"less\">\r\n.upload-loading {\r\n  color: yellow;\r\n}\r\n.upload-success {\r\n  color: green;\r\n}\r\n.upload-error {\r\n  color: red;\r\n}\r\n</style>"]}]}